!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";const e="undefined"!=typeof window&&null!=window.customElements&&void 0!==window.customElements.polyfillWrapFlushCallback,t=(e,t,s=null)=>{for(;t!==s;){const s=t.nextSibling;e.removeChild(t),t=s}},s=`{{lit-${String(Math.random()).slice(2)}}}`,r=`\x3c!--${s}--\x3e`,i=new RegExp(`${s}|${r}`);class n{constructor(e,t){this.parts=[],this.element=t;const r=[],n=[],a=document.createTreeWalker(t.content,133,null,!1);let p=0,h=-1,d=0;const{strings:u,values:{length:g}}=e;for(;d<g;){const e=a.nextNode();if(null!==e){if(h++,1===e.nodeType){if(e.hasAttributes()){const t=e.attributes,{length:s}=t;let r=0;for(let e=0;e<s;e++)o(t[e].name,"$lit$")&&r++;for(;r-- >0;){const t=u[d],s=c.exec(t)[2],r=s.toLowerCase()+"$lit$",n=e.getAttribute(r);e.removeAttribute(r);const o=n.split(i);this.parts.push({type:"attribute",index:h,name:s,strings:o}),d+=o.length-1}}"TEMPLATE"===e.tagName&&(n.push(e),a.currentNode=e.content)}else if(3===e.nodeType){const t=e.data;if(t.indexOf(s)>=0){const s=e.parentNode,n=t.split(i),a=n.length-1;for(let t=0;t<a;t++){let r,i=n[t];if(""===i)r=l();else{const e=c.exec(i);null!==e&&o(e[2],"$lit$")&&(i=i.slice(0,e.index)+e[1]+e[2].slice(0,-"$lit$".length)+e[3]),r=document.createTextNode(i)}s.insertBefore(r,e),this.parts.push({type:"node",index:++h})}""===n[a]?(s.insertBefore(l(),e),r.push(e)):e.data=n[a],d+=a}}else if(8===e.nodeType)if(e.data===s){const t=e.parentNode;null!==e.previousSibling&&h!==p||(h++,t.insertBefore(l(),e)),p=h,this.parts.push({type:"node",index:h}),null===e.nextSibling?e.data="":(r.push(e),h--),d++}else{let t=-1;for(;-1!==(t=e.data.indexOf(s,t+1));)this.parts.push({type:"node",index:-1}),d++}}else a.currentNode=n.pop()}for(const e of r)e.parentNode.removeChild(e)}}const o=(e,t)=>{const s=e.length-t.length;return s>=0&&e.slice(s)===t},a=e=>-1!==e.index,l=()=>document.createComment(""),c=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;function p(e,t){const{element:{content:s},parts:r}=e,i=document.createTreeWalker(s,133,null,!1);let n=d(r),o=r[n],a=-1,l=0;const c=[];let p=null;for(;i.nextNode();){a++;const e=i.currentNode;for(e.previousSibling===p&&(p=null),t.has(e)&&(c.push(e),null===p&&(p=e)),null!==p&&l++;void 0!==o&&o.index===a;)o.index=null!==p?-1:o.index-l,n=d(r,n),o=r[n]}c.forEach(e=>e.parentNode.removeChild(e))}const h=e=>{let t=11===e.nodeType?0:1;const s=document.createTreeWalker(e,133,null,!1);for(;s.nextNode();)t++;return t},d=(e,t=-1)=>{for(let s=t+1;s<e.length;s++){const t=e[s];if(a(t))return s}return-1};const u=new WeakMap,g=e=>"function"==typeof e&&u.has(e),m={},y={};class _{constructor(e,t,s){this.__parts=[],this.template=e,this.processor=t,this.options=s}update(e){let t=0;for(const s of this.__parts)void 0!==s&&s.setValue(e[t]),t++;for(const e of this.__parts)void 0!==e&&e.commit()}_clone(){const t=e?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),s=[],r=this.template.parts,i=document.createTreeWalker(t,133,null,!1);let n,o=0,l=0,c=i.nextNode();for(;o<r.length;)if(n=r[o],a(n)){for(;l<n.index;)l++,"TEMPLATE"===c.nodeName&&(s.push(c),i.currentNode=c.content),null===(c=i.nextNode())&&(i.currentNode=s.pop(),c=i.nextNode());if("node"===n.type){const e=this.processor.handleTextExpression(this.options);e.insertAfterNode(c.previousSibling),this.__parts.push(e)}else this.__parts.push(...this.processor.handleAttributeExpressions(c,n.name,n.strings,this.options));o++}else this.__parts.push(void 0),o++;return e&&(document.adoptNode(t),customElements.upgrade(t)),t}}const f=` ${s} `;class w{constructor(e,t,s,r){this.strings=e,this.values=t,this.type=s,this.processor=r}getHTML(){const e=this.strings.length-1;let t="",i=!1;for(let n=0;n<e;n++){const e=this.strings[n],o=e.lastIndexOf("\x3c!--");i=(o>-1||i)&&-1===e.indexOf("--\x3e",o+1);const a=c.exec(e);t+=null===a?e+(i?f:r):e.substr(0,a.index)+a[1]+a[2]+"$lit$"+a[3]+s}return t+=this.strings[e],t}getTemplateElement(){const e=document.createElement("template");return e.innerHTML=this.getHTML(),e}}const S=e=>null===e||!("object"==typeof e||"function"==typeof e),v=e=>Array.isArray(e)||!(!e||!e[Symbol.iterator]);class b{constructor(e,t,s){this.dirty=!0,this.element=e,this.name=t,this.strings=s,this.parts=[];for(let e=0;e<s.length-1;e++)this.parts[e]=this._createPart()}_createPart(){return new E(this)}_getValue(){const e=this.strings,t=e.length-1;let s="";for(let r=0;r<t;r++){s+=e[r];const t=this.parts[r];if(void 0!==t){const e=t.value;if(S(e)||!v(e))s+="string"==typeof e?e:String(e);else for(const t of e)s+="string"==typeof t?t:String(t)}}return s+=e[t],s}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}}class E{constructor(e){this.value=void 0,this.committer=e}setValue(e){e===m||S(e)&&e===this.value||(this.value=e,g(e)||(this.committer.dirty=!0))}commit(){for(;g(this.value);){const e=this.value;this.value=m,e(this)}this.value!==m&&this.committer.commit()}}class x{constructor(e){this.value=void 0,this.__pendingValue=void 0,this.options=e}appendInto(e){this.startNode=e.appendChild(l()),this.endNode=e.appendChild(l())}insertAfterNode(e){this.startNode=e,this.endNode=e.nextSibling}appendIntoPart(e){e.__insert(this.startNode=l()),e.__insert(this.endNode=l())}insertAfterPart(e){e.__insert(this.startNode=l()),this.endNode=e.endNode,e.endNode=this.startNode}setValue(e){this.__pendingValue=e}commit(){if(null===this.startNode.parentNode)return;for(;g(this.__pendingValue);){const e=this.__pendingValue;this.__pendingValue=m,e(this)}const e=this.__pendingValue;e!==m&&(S(e)?e!==this.value&&this.__commitText(e):e instanceof w?this.__commitTemplateResult(e):e instanceof Node?this.__commitNode(e):v(e)?this.__commitIterable(e):e===y?(this.value=y,this.clear()):this.__commitText(e))}__insert(e){this.endNode.parentNode.insertBefore(e,this.endNode)}__commitNode(e){this.value!==e&&(this.clear(),this.__insert(e),this.value=e)}__commitText(e){const t=this.startNode.nextSibling,s="string"==typeof(e=null==e?"":e)?e:String(e);t===this.endNode.previousSibling&&3===t.nodeType?t.data=s:this.__commitNode(document.createTextNode(s)),this.value=e}__commitTemplateResult(e){const t=this.options.templateFactory(e);if(this.value instanceof _&&this.value.template===t)this.value.update(e.values);else{const s=new _(t,e.processor,this.options),r=s._clone();s.update(e.values),this.__commitNode(r),this.value=s}}__commitIterable(e){Array.isArray(this.value)||(this.value=[],this.clear());const t=this.value;let s,r=0;for(const i of e)s=t[r],void 0===s&&(s=new x(this.options),t.push(s),0===r?s.appendIntoPart(this):s.insertAfterPart(t[r-1])),s.setValue(i),s.commit(),r++;r<t.length&&(t.length=r,this.clear(s&&s.endNode))}clear(e=this.startNode){t(this.startNode.parentNode,e.nextSibling,this.endNode)}}class T{constructor(e,t,s){if(this.value=void 0,this.__pendingValue=void 0,2!==s.length||""!==s[0]||""!==s[1])throw new Error("Boolean attributes can only contain a single expression");this.element=e,this.name=t,this.strings=s}setValue(e){this.__pendingValue=e}commit(){for(;g(this.__pendingValue);){const e=this.__pendingValue;this.__pendingValue=m,e(this)}if(this.__pendingValue===m)return;const e=!!this.__pendingValue;this.value!==e&&(e?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=e),this.__pendingValue=m}}class P extends b{constructor(e,t,s){super(e,t,s),this.single=2===s.length&&""===s[0]&&""===s[1]}_createPart(){return new N(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}}class N extends E{}let A=!1;(()=>{try{const e={get capture(){return A=!0,!1}};window.addEventListener("test",e,e),window.removeEventListener("test",e,e)}catch(e){}})();class C{constructor(e,t,s){this.value=void 0,this.__pendingValue=void 0,this.element=e,this.eventName=t,this.eventContext=s,this.__boundHandleEvent=e=>this.handleEvent(e)}setValue(e){this.__pendingValue=e}commit(){for(;g(this.__pendingValue);){const e=this.__pendingValue;this.__pendingValue=m,e(this)}if(this.__pendingValue===m)return;const e=this.__pendingValue,t=this.value,s=null==e||null!=t&&(e.capture!==t.capture||e.once!==t.once||e.passive!==t.passive),r=null!=e&&(null==t||s);s&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),r&&(this.__options=R(e),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=e,this.__pendingValue=m}handleEvent(e){"function"==typeof this.value?this.value.call(this.eventContext||this.element,e):this.value.handleEvent(e)}}const R=e=>e&&(A?{capture:e.capture,passive:e.passive,once:e.once}:e.capture);function M(e){let t=O.get(e.type);void 0===t&&(t={stringsArray:new WeakMap,keyString:new Map},O.set(e.type,t));let r=t.stringsArray.get(e.strings);if(void 0!==r)return r;const i=e.strings.join(s);return r=t.keyString.get(i),void 0===r&&(r=new n(e,e.getTemplateElement()),t.keyString.set(i,r)),t.stringsArray.set(e.strings,r),r}const O=new Map,U=new WeakMap;const I=new class{handleAttributeExpressions(e,t,s,r){const i=t[0];if("."===i){return new P(e,t.slice(1),s).parts}if("@"===i)return[new C(e,t.slice(1),r.eventContext)];if("?"===i)return[new T(e,t.slice(1),s)];return new b(e,t,s).parts}handleTextExpression(e){return new x(e)}};"undefined"!=typeof window&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.2.1");const V=(e,...t)=>new w(e,t,"html",I),k=(e,t)=>`${e}--${t}`;let q=!0;void 0===window.ShadyCSS?q=!1:void 0===window.ShadyCSS.prepareTemplateDom&&(console.warn("Incompatible ShadyCSS version detected. Please update to at least @webcomponents/webcomponentsjs@2.0.2 and @webcomponents/shadycss@1.3.1."),q=!1);const D=e=>t=>{const r=k(t.type,e);let i=O.get(r);void 0===i&&(i={stringsArray:new WeakMap,keyString:new Map},O.set(r,i));let o=i.stringsArray.get(t.strings);if(void 0!==o)return o;const a=t.strings.join(s);if(o=i.keyString.get(a),void 0===o){const s=t.getTemplateElement();q&&window.ShadyCSS.prepareTemplateDom(s,e),o=new n(t,s),i.keyString.set(a,o)}return i.stringsArray.set(t.strings,o),o},L=["html","svg"],F=new Set,z=(e,t,s)=>{F.add(e);const r=s?s.element:document.createElement("template"),i=t.querySelectorAll("style"),{length:n}=i;if(0===n)return void window.ShadyCSS.prepareTemplateStyles(r,e);const o=document.createElement("style");for(let e=0;e<n;e++){const t=i[e];t.parentNode.removeChild(t),o.textContent+=t.textContent}(e=>{L.forEach(t=>{const s=O.get(k(t,e));void 0!==s&&s.keyString.forEach(e=>{const{element:{content:t}}=e,s=new Set;Array.from(t.querySelectorAll("style")).forEach(e=>{s.add(e)}),p(e,s)})})})(e);const a=r.content;s?function(e,t,s=null){const{element:{content:r},parts:i}=e;if(null==s)return void r.appendChild(t);const n=document.createTreeWalker(r,133,null,!1);let o=d(i),a=0,l=-1;for(;n.nextNode();){l++;for(n.currentNode===s&&(a=h(t),s.parentNode.insertBefore(t,s));-1!==o&&i[o].index===l;){if(a>0){for(;-1!==o;)i[o].index+=a,o=d(i,o);return}o=d(i,o)}}}(s,o,a.firstChild):a.insertBefore(o,a.firstChild),window.ShadyCSS.prepareTemplateStyles(r,e);const l=a.querySelector("style");if(window.ShadyCSS.nativeShadow&&null!==l)t.insertBefore(l.cloneNode(!0),t.firstChild);else if(s){a.insertBefore(o,a.firstChild);const e=new Set;e.add(o),p(s,e)}};window.JSCompiler_renameProperty=(e,t)=>e;const $={toAttribute(e,t){switch(t){case Boolean:return e?"":null;case Object:case Array:return null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){switch(t){case Boolean:return null!==e;case Number:return null===e?null:Number(e);case Object:case Array:return JSON.parse(e)}return e}},j=(e,t)=>t!==e&&(t==t||e==e),B={attribute:!0,type:String,converter:$,reflect:!1,hasChanged:j};class H extends HTMLElement{constructor(){super(),this._updateState=0,this._instanceProperties=void 0,this._updatePromise=new Promise(e=>this._enableUpdatingResolver=e),this._changedProperties=new Map,this._reflectingProperties=void 0,this.initialize()}static get observedAttributes(){this.finalize();const e=[];return this._classProperties.forEach((t,s)=>{const r=this._attributeNameForProperty(s,t);void 0!==r&&(this._attributeToPropertyMap.set(r,s),e.push(r))}),e}static _ensureClassProperties(){if(!this.hasOwnProperty(JSCompiler_renameProperty("_classProperties",this))){this._classProperties=new Map;const e=Object.getPrototypeOf(this)._classProperties;void 0!==e&&e.forEach((e,t)=>this._classProperties.set(t,e))}}static createProperty(e,t=B){if(this._ensureClassProperties(),this._classProperties.set(e,t),t.noAccessor||this.prototype.hasOwnProperty(e))return;const s="symbol"==typeof e?Symbol():"__"+e,r=this.getPropertyDescriptor(e,s,t);void 0!==r&&Object.defineProperty(this.prototype,e,r)}static getPropertyDescriptor(e,t,s){return{get(){return this[t]},set(s){const r=this[e];this[t]=s,this._requestUpdate(e,r)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this._classProperties&&this._classProperties.get(e)||B}static finalize(){const e=Object.getPrototypeOf(this);if(e.hasOwnProperty("finalized")||e.finalize(),this.finalized=!0,this._ensureClassProperties(),this._attributeToPropertyMap=new Map,this.hasOwnProperty(JSCompiler_renameProperty("properties",this))){const e=this.properties,t=[...Object.getOwnPropertyNames(e),..."function"==typeof Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e):[]];for(const s of t)this.createProperty(s,e[s])}}static _attributeNameForProperty(e,t){const s=t.attribute;return!1===s?void 0:"string"==typeof s?s:"string"==typeof e?e.toLowerCase():void 0}static _valueHasChanged(e,t,s=j){return s(e,t)}static _propertyValueFromAttribute(e,t){const s=t.type,r=t.converter||$,i="function"==typeof r?r:r.fromAttribute;return i?i(e,s):e}static _propertyValueToAttribute(e,t){if(void 0===t.reflect)return;const s=t.type,r=t.converter;return(r&&r.toAttribute||$.toAttribute)(e,s)}initialize(){this._saveInstanceProperties(),this._requestUpdate()}_saveInstanceProperties(){this.constructor._classProperties.forEach((e,t)=>{if(this.hasOwnProperty(t)){const e=this[t];delete this[t],this._instanceProperties||(this._instanceProperties=new Map),this._instanceProperties.set(t,e)}})}_applyInstanceProperties(){this._instanceProperties.forEach((e,t)=>this[t]=e),this._instanceProperties=void 0}connectedCallback(){this.enableUpdating()}enableUpdating(){void 0!==this._enableUpdatingResolver&&(this._enableUpdatingResolver(),this._enableUpdatingResolver=void 0)}disconnectedCallback(){}attributeChangedCallback(e,t,s){t!==s&&this._attributeToProperty(e,s)}_propertyToAttribute(e,t,s=B){const r=this.constructor,i=r._attributeNameForProperty(e,s);if(void 0!==i){const e=r._propertyValueToAttribute(t,s);if(void 0===e)return;this._updateState=8|this._updateState,null==e?this.removeAttribute(i):this.setAttribute(i,e),this._updateState=-9&this._updateState}}_attributeToProperty(e,t){if(8&this._updateState)return;const s=this.constructor,r=s._attributeToPropertyMap.get(e);if(void 0!==r){const e=s.getPropertyOptions(r);this._updateState=16|this._updateState,this[r]=s._propertyValueFromAttribute(t,e),this._updateState=-17&this._updateState}}_requestUpdate(e,t){let s=!0;if(void 0!==e){const r=this.constructor,i=r.getPropertyOptions(e);r._valueHasChanged(this[e],t,i.hasChanged)?(this._changedProperties.has(e)||this._changedProperties.set(e,t),!0!==i.reflect||16&this._updateState||(void 0===this._reflectingProperties&&(this._reflectingProperties=new Map),this._reflectingProperties.set(e,i))):s=!1}!this._hasRequestedUpdate&&s&&(this._updatePromise=this._enqueueUpdate())}requestUpdate(e,t){return this._requestUpdate(e,t),this.updateComplete}async _enqueueUpdate(){this._updateState=4|this._updateState;try{await this._updatePromise}catch(e){}const e=this.performUpdate();return null!=e&&await e,!this._hasRequestedUpdate}get _hasRequestedUpdate(){return 4&this._updateState}get hasUpdated(){return 1&this._updateState}performUpdate(){this._instanceProperties&&this._applyInstanceProperties();let e=!1;const t=this._changedProperties;try{e=this.shouldUpdate(t),e?this.update(t):this._markUpdated()}catch(t){throw e=!1,this._markUpdated(),t}e&&(1&this._updateState||(this._updateState=1|this._updateState,this.firstUpdated(t)),this.updated(t))}_markUpdated(){this._changedProperties=new Map,this._updateState=-5&this._updateState}get updateComplete(){return this._getUpdateComplete()}_getUpdateComplete(){return this._updatePromise}shouldUpdate(e){return!0}update(e){void 0!==this._reflectingProperties&&this._reflectingProperties.size>0&&(this._reflectingProperties.forEach((e,t)=>this._propertyToAttribute(t,this[t],e)),this._reflectingProperties=void 0),this._markUpdated()}updated(e){}firstUpdated(e){}}H.finalized=!0;const W="adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Q=Symbol();class Y{constructor(e,t){if(t!==Q)throw new Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e}get styleSheet(){return void 0===this._styleSheet&&(W?(this._styleSheet=new CSSStyleSheet,this._styleSheet.replaceSync(this.cssText)):this._styleSheet=null),this._styleSheet}toString(){return this.cssText}}const K=(e,...t)=>{const s=t.reduce((t,s,r)=>t+(e=>{if(e instanceof Y)return e.cssText;if("number"==typeof e)return e;throw new Error(`Value passed to 'css' function must be a 'css' function result: ${e}. Use 'unsafeCSS' to pass non-literal values, but\n            take care to ensure page security.`)})(s)+e[r+1],e[0]);return new Y(s,Q)};(window.litElementVersions||(window.litElementVersions=[])).push("2.3.1");const J={};class X extends H{static getStyles(){return this.styles}static _getUniqueStyles(){if(this.hasOwnProperty(JSCompiler_renameProperty("_styles",this)))return;const e=this.getStyles();if(void 0===e)this._styles=[];else if(Array.isArray(e)){const t=(e,s)=>e.reduceRight((e,s)=>Array.isArray(s)?t(s,e):(e.add(s),e),s),s=t(e,new Set),r=[];s.forEach(e=>r.unshift(e)),this._styles=r}else this._styles=[e]}initialize(){super.initialize(),this.constructor._getUniqueStyles(),this.renderRoot=this.createRenderRoot(),window.ShadowRoot&&this.renderRoot instanceof window.ShadowRoot&&this.adoptStyles()}createRenderRoot(){return this.attachShadow({mode:"open"})}adoptStyles(){const e=this.constructor._styles;0!==e.length&&(void 0===window.ShadyCSS||window.ShadyCSS.nativeShadow?W?this.renderRoot.adoptedStyleSheets=e.map(e=>e.styleSheet):this._needsShimAdoptedStyleSheets=!0:window.ShadyCSS.ScopingShim.prepareAdoptedCssText(e.map(e=>e.cssText),this.localName))}connectedCallback(){super.connectedCallback(),this.hasUpdated&&void 0!==window.ShadyCSS&&window.ShadyCSS.styleElement(this)}update(e){const t=this.render();super.update(e),t!==J&&this.constructor.render(t,this.renderRoot,{scopeName:this.localName,eventContext:this}),this._needsShimAdoptedStyleSheets&&(this._needsShimAdoptedStyleSheets=!1,this.constructor._styles.forEach(e=>{const t=document.createElement("style");t.textContent=e.cssText,this.renderRoot.appendChild(t)}))}render(){return J}}X.finalized=!0,X.render=(e,s,r)=>{if(!r||"object"!=typeof r||!r.scopeName)throw new Error("The `scopeName` option is required.");const i=r.scopeName,n=U.has(s),o=q&&11===s.nodeType&&!!s.host,a=o&&!F.has(i),l=a?document.createDocumentFragment():s;if(((e,s,r)=>{let i=U.get(s);void 0===i&&(t(s,s.firstChild),U.set(s,i=new x(Object.assign({templateFactory:M},r))),i.appendInto(s)),i.setValue(e),i.commit()})(e,l,Object.assign({templateFactory:D(i)},r)),a){const e=U.get(l);U.delete(l);const r=e.value instanceof _?e.value.template:void 0;z(i,l,r),t(s,s.firstChild),s.appendChild(l),U.set(s,e)}!n&&o&&window.ShadyCSS.styleElement(s.host)};class G{static prepareOutgoingData(e){return JSON.stringify(e)}constructor(e){if(!e)throw new Error("Source must be spcified");if(!this.constructor.type)throw new Error("Type not defined");if(this.constructor.name||console.warn("No name provided"),this.constructor.description||console.warn("No description provided"),!this.sendMessage)throw new Error("A new target requires a sendMessage method")}}const Z={},ee={};class te{static registerPlugin(e,t){return e.init(te,t),te}static registerTargetType(e,t){if(e in ee)throw new Error("Target type has already been registered");if(!(t.prototype instanceof G))throw new Error("Target constructors must inherit from the Target base class");return ee[e]=t,te}static registerEpmlMessageType(e,t){return Z[e]=t,te}registerPlugin(e){return e.init(this),this}static handleMessage(e,t){const s=te.prepareIncomingData(e);"EpmlMessageType"in s&&Z[s.EpmlMessageType](s,t,this)}static prepareIncomingData(e){return"string"!=typeof e?e:JSON.parse(e)}static createTargets(e){Array.isArray(e)||(e=[e]);const t=[];for(const s of e)void 0===s.allowObjects&&(s.allowObjects=!1),t.push(...te.createTarget(s));return t}static createTarget(e){if(!ee[e.type])throw new Error(`Target type '${e.type}' not registered`);let t=new ee[e.type](e.source);Array.isArray(t)||(t=[t]);for(const s of t)s.allowObjects=e.allowObjects;return t}constructor(e){this.targets=this.constructor.createTargets(e)}}var se=(e,t)=>{for(t=e="";e++<36;t+=51*e&52?(15^e?8^Math.random()*(20^e?16:4):4).toString(16):"-");return t};const re={},ie={init:(e,t)=>{if(e.prototype.ready)throw new Error("Epml.prototype.ready is already defined");if(e.prototype.imReady)throw new Error("Epml.prototype.imReady is already defined");e.prototype.ready=ae,e.prototype.resetReadyCheck=le,e.prototype.imReady=oe,e.registerEpmlMessageType("EPML_READY_STATE_CHECK",ne),e.registerEpmlMessageType("EPML_READY_STATE_CHECK_RESPONSE",pe)}};function ne(e,t){t._i_am_ready&&t.sendMessage({EpmlMessageType:"EPML_READY_STATE_CHECK_RESPONSE",requestID:e.requestID})}function oe(){for(const e of this.targets)e._i_am_ready=!0}function ae(){return this._ready_plugin=this._ready_plugin||{},this._ready_plugin.pendingReadyResolves=this._ready_plugin.pendingReadyResolves?this._ready_plugin.pendingReadyResolves:[],this._pending_ready_checking||(this._pending_ready_checking=!0,ce.call(this,this.targets).then(()=>{this._ready_plugin.pendingReadyResolves.forEach(e=>e())})),new Promise(e=>{this._ready_plugin.isReady?e():this._ready_plugin.pendingReadyResolves.push(e)})}function le(){this._ready_plugin=this._ready_plugin||{},this._ready_plugin.isReady=!1}function ce(e){return this._ready_plugin=this._ready_plugin||{},this._ready_plugin.pendingReadyResolves=[],Promise.all(e.map(e=>new Promise((t,s)=>{const r=se(),i=setInterval(()=>{e.sendMessage({EpmlMessageType:"EPML_READY_STATE_CHECK",requestID:r})},15);re[r]=()=>{clearInterval(i),t()}}))).then(()=>{this._ready_plugin.isReady=!0})}function pe(e,t){t._ready_plugin=t._ready_plugin||{},t._ready_plugin._is_ready=!0,re[e.requestID]()}const he=new Map;class de extends G{static get sources(){return Array.from(he.keys())}static get targets(){return Array.from(he.values())}static getTargetFromSource(e){return he.get(e)}static hasTarget(e){return he.has(e)}static get type(){return"WINDOW"}static get name(){return"Content window plugin"}static get description(){return"Allows Epml to communicate with iframes and popup windows."}static test(e){return"object"==typeof e&&e===e.self}isFrom(e){}constructor(e){if(super(e),he.has(e))return he.get(e);if(!this.constructor.test(e))throw new Error("Source can not be used with target");this._source=e,this._sourceOrigin="*",he.set(e,this)}get source(){return this._source}sendMessage(e){e=G.prepareOutgoingData(e),this._source.postMessage(e,this._sourceOrigin)}}var ue={init:function(e){!function(e,t,s){if(e.addEventListener)e.addEventListener(t,s,!1);else{if(!e.attachEvent)throw new Error("Could not bind event.");e.attachEvent("on"+t,s)}}(window,"message",t=>{de.hasTarget(t.source)&&e.handleMessage(t.data,de.getTargetFromSource(t.source))}),e.registerTargetType(de.type,de)}};const ge=new Map,me={},ye={init:(e,t)=>{if(e.prototype.request)throw new Error("Epml.prototype.request is already defined");if(e.prototype.route)throw new Error("Empl.prototype.route is already defined");e.prototype.request=_e,e.prototype.route=Se,e.registerEpmlMessageType("REQUEST",we),e.registerEpmlMessageType("REQUEST_RESPONSE",fe)}},_e=function(e,t,s){return Promise.all(this.targets.map(r=>{const i=se(),n={EpmlMessageType:"REQUEST",requestOrResponse:"request",requestID:i,requestType:e,data:t};return r.sendMessage(n),new Promise((e,t)=>{let r;s&&(r=setTimeout(()=>{delete me[i],t(new Error("Request timed out"))},s)),me[i]=(...t)=>{r&&clearTimeout(r),e(...t)}})})).then(e=>{if(1===this.targets.length)return e[0]})};function fe(e,t,s){if(e.requestID in me){const t=e.data;me[e.requestID](t)}else console.warn("requestID not found in pendingRequests")}function we(e,t){if(!ge.has(t))return void console.warn("Route does not exist - missing target");const s=ge.get(t)[e.requestType];s?s(e,t):console.warn("Route does not exist")}function Se(e,t){if(this.routes||(this.routes={}),!this.routes[e])for(const s of this.targets){ge.has(s)||ge.set(s,{});ge.get(s)[e]=(e,s)=>{Promise.resolve(t(e)).catch(e=>e instanceof Error?e.message:e).then(t=>{s.sendMessage({data:t,EpmlMessageType:"REQUEST_RESPONSE",requestOrResponse:"request",requestID:e.requestID})})}}}const ve=new class{constructor(e){this._map=e||new Map,this._revMap=new Map,this._map.forEach((e,t)=>{this._revMap.set(t,e)})}values(){return this._map.values()}entries(){return this._map.entries()}push(e,t){this._map.set(e,t),this._revMap.set(t,e)}getByKey(e){return this._map.get(e)}getByValue(e){return this._revMap.get(e)}hasKey(e){return this._map.has(e)}hasValue(e){return this._revMap.has(e)}deleteByKey(e){const t=this._map.get(e);this._map.delete(e),this._revMap.delete(t)}deleteByValue(e){const t=this._revMap.get(e);this._map.delete(t),this._revMap.delete(e)}};class be extends G{static get proxySources(){return ve}static get sources(){for(const[e,t]of ve)for(const[e]of t);Array.from(ve.entries()).map((e,t)=>({proxy:e,target:Array.from(t.keys())[0]}))}static get targets(){return Array.from(ve.values())}static getTargetFromSource(e){return ve.getByValue(e)}static hasTarget(e){return ve.hasValue(e)}static get type(){return"PROXY"}static get name(){return"Proxy target"}static get description(){return"Uses other target, and proxies requests, allowing things like iframes to communicate through their host"}static test(e){return"object"==typeof e&&e.proxy instanceof this.Epml}isFrom(e){}constructor(e){if(super(e),this.constructor.proxySources.push(e.id,this),!this.constructor.test(e))throw new Error("Source can not be used with target");this._source=e}get source(){return this._source}sendMessage(e){const t=se();e=G.prepareOutgoingData(e),e={EpmlMessageType:"PROXY_MESSAGE",state:"TRANSIT",requestID:t,target:this._source.target,message:e,id:this._source.id},this._source.proxy.targets[0].sendMessage(e)}}const Ee=be.proxySources;let xe;var Te={init:function(e){Object.defineProperty(be,"Epml",{get:()=>e}),xe=e,e.registerTargetType(be.type,be),e.registerProxyInstance=Ne,e.registerEpmlMessageType("PROXY_MESSAGE",Pe)}};function Pe(e,t){if("TRANSIT"===e.state){const t=Ee.getByKey(e.target);if(!t)return void console.warn(`Target ${e.target} not registered.`);e.state="DELIVERY",t.targets.forEach(t=>t.sendMessage(e))}else if("DELIVERY"===e.state){if(!Ee.getByKey(e.target))return void console.warn(`Target ${e.target} not registered.`);const t=Ee.getByKey(e.target);xe.handleMessage(e.message,t)}}function Ne(e,t){Ee.hasKey(e)&&console.warn(e+" is already defined. Overwriting..."),Ee.push(e,t)}const Ae={};class Ce{static get streams(){return Ae}constructor(e,t=(()=>{})){if(this._name=e,this.targets=[],this._subscriptionFn=t,e in Ae)return console.warn(`Stream with name ${e} already exists! Returning it instead`),Ae[e];Ae[e]=this}async subscribe(e){e in this.targets&&console.info("Target is already subscribed to this stream");const t=await this._subscriptionFn();this._sendMessage(t,e),this.targets.push(e)}_sendMessage(e,t){t.sendMessage({data:G.prepareOutgoingData(e),EpmlMessageType:"STREAM_UPDATE",streamName:this._name})}emit(e){this.targets.forEach(t=>this._sendMessage(e,t))}}const Re={},Me={init:(e,t)=>{if(e.prototype.subscribe)throw new Error("Epml.prototype.subscribe is already defined");if(e.prototype.createStream)throw new Error("Empl.prototype.createStream is already defined");e.prototype.subscribe=Ue,e.registerEpmlMessageType("JOIN_STREAM",Oe),e.registerEpmlMessageType("STREAM_UPDATE",Ie)}},Oe=function(e,t){const s=e.data.name,r=Ce.streams[s];r?r.subscribe(t):console.warn("No stream with name "+s,this)},Ue=function(e,t){this.targets.forEach(t=>{t.sendMessage({EpmlMessageType:"JOIN_STREAM",data:{name:e}})}),Re[e]=Re[e]||[],Re[e].push(t)},Ie=function(e,t){Re[e.streamName].forEach(t=>t(e.data))};te.registerPlugin(ye),te.registerPlugin(ie),te.registerPlugin(ue),te.registerPlugin(Me),te.registerPlugin(Te),te.allowProxying=!0;const Ve=new te({type:"WINDOW",source:window.parent});window.customElements.define("q-messaging",class extends X{static get properties(){return{}}static get styles(){return K`
            * {
                --mdc-theme-primary: rgb(3, 169, 244);
            }
            #page {
                background: #b5f7f4;
                padding: 12px 24px;
            }

            h2 {
                margin:0;
                font-weight: 400;
            }

            h3, h4, h5 {
                color:#333;
                font-weight: 400;
            }

            .major-title {
                color: #333/*rgb(3, 169, 244)*/;
                margin-top: 1rem;
                font-weight: 400;
                font-size: 28px;
                text-align: center;
            }

            .sub-title {
                color: #333/*rgb(3, 169, 244)*/;
                margin-top: .5rem;
                font-weight: 400;
                /* font-size: 19px; */
                text-align: center;
            }

            .sub-title:hover {
                cursor: pointer;                
                color: rgb(3, 169, 244);
            }

            .sub-url {
                font-size: 19px;
                text-decoration: underline;
            }

            .sub-url:hover {
                cursor: pointer;
            }

            .divCard {
                border: 1px solid #eee;
                padding: 1em;
                /** box-shadow: 0 1px 1px 0 rgba(0,0,0,0.14), 0 2px 1px -1px rgba(0,0,0,0.12), 0 1px 2px 0 rgba(0,0,0,0.20); **/
                box-shadow: 0 .3px 1px 0 rgba(0,0,0,0.14), 0 1px 1px -1px rgba(0,0,0,0.12), 0 1px 2px 0 rgba(0,0,0,0.20);
                margin-bottom: 1.5rem;
                background-color: #65a8dd;
            }

            p {
                color:#333;
            }

            ul, ul li {
                color:#333;
            }
        `}constructor(){super()}render(){return V`
            <div id="page">
                <div class="divCard">
                    <h2 class="major-title">Welcome to the Qortal Messaging System!</h2>
                    <p style="font-size: 19px;">With this system, you are able to accomplish multiple types of messaging available to you in Qortal:</p>
                    <ul>
                        <li class="sub-url" @click=${()=>this.getUrl("chain-messaging")}><strong>Chain Based Messaging</strong></li>
                        <li class="sub-url" @click=${()=>this.getUrl("q-chat")}><strong>T-Chat</strong></li>
                    </ul>
                </div>
                
                <div class="divCard">
                    <h3 class="sub-title" @click=${()=>this.getUrl("chain-messaging")}>Chain-Based Messaging</h3>
                    <p style="font-size: 17px;">A long-term message that is stored <strong>ON CHAIN</strong>. 
                    These messages <strong>are able</strong> to be <strong>sent to groups or individual accounts</strong>, and are essentially <strong>the 'e-mail' of Qortal</strong>. 
                    Use these messages if you intend on the message being a <strong>PERMANENT message</strong> that stays when and where you send it.</p>

                    <!-- <span style="display: block; text-align: center"><strong>- more info -</strong></span> -->

                    <ul>
                        <li style="font-size: 17px; padding: 10px;">There are no @ in Qortal Chain Messaging, only 'registered names'. As the registered names on the chain can only be registered ONCE. Therefore, there are NO DUPLICATES.</li>
                        <li style="font-size: 17px; padding: 10px;">Chain Messages LAST FOREVER</li>
                        <li style="font-size: 17px; padding: 10px;"><strong>Encyption is DEFAULT</strong>, unless chosen to be NOT encrypted. (also known as a 'public message' which are readable by an api call from anyone.)</li>
                        <li style="font-size: 17px; padding: 10px;">'Attachments' will be possible in the future, with the use of the Qortal Data System.</li>
                        <li style="font-size: 17px; padding: 10px;">Public Messages can be used for 'verification purposes' such as 'copyrights' or 'I did it first' notations. The terms 'copyright' and 'patent' are a thing of the past, if you did it first, put in a public message, and it is by default proven.</li>
                    </ul>

                </div>

                <div class="divCard">
                    <h3 class="sub-title" @click=${()=>this.getUrl("q-chat")}>T-Chat</h3>
                    <p style="font-size: 17px;">Is a custom chat system that is UNLIKE ANY OTHER in existence. It is the FIRST OF ITS KIND IN THE WORLD. 
                    It is a real-time, blockchain-based chat system that utilizes a memory-based PoW (Proof Of Work) algorithm, to implement a specialized transaction that is 'temporary', on the Qortal blockchain. 
                    T-Chat messages will DISSAPEAR AFTER 24 HOURS and therefore are not a great choice for things you wish to be permanent.</p>

                    <ul>
                        <li style="font-size: 17px; padding: 10px;"><strong>In the future, there will be a 'pinning' system</strong>, that will allow you to convert, or send messages by default with, the ability to stay forever on the Qortal Blockchain. So that if you DO decide that you like a message enough to keep it forever, you may do so.</li>
                        <li style="font-size: 17px; padding: 10px;"><strong>T-chat messages are encrypted</strong> (at the moment in June, 2020, T-chat PM's are encrypted, but the group messages are base58 encoded, meaning they aren't plain text, but if you're smart you can decode them. However, IN THE NEAR FUTURE, ALL MESSAGES REGARDLESS OF GROUP OR PM WILL BE DEFAULT ENCRYPTED WITH PUB/PRIV KEY OF YOUR QORTAL ACCOUNT.</li>
                        <li style="font-size: 17px; padding: 10px;">Uses a UNIQUE memory-based PoW algorithm, to send messages FREE (no transaction fee)</li>
                        <li style="font-size: 17px; padding: 10px;">Text-based messaging for the future.</li>
                    </ul>

                </div>
            </div>
        `}getUrl(e){this.onPageNavigation("/app/"+e)}onPageNavigation(e){Ve.request("setPageUrl",e)}firstUpdated(){window.addEventListener("contextmenu",e=>{e.preventDefault(),this._textMenu(e)}),window.addEventListener("click",()=>{Ve.request("closeCopyTextMenu",null)}),window.onkeyup=e=>{27===e.keyCode&&Ve.request("closeCopyTextMenu",null)},Ve.ready().then(()=>{Ve.subscribe("selected_address",async e=>{this.selectedAddress={},(e=JSON.parse(e))&&0!==Object.entries(e).length&&(this.selectedAddress=e)}),Ve.subscribe("config",e=>{this.config=JSON.parse(e)}),Ve.subscribe("copy_menu_switch",async e=>{"false"===e&&0!==window.getSelection().toString().length&&this.clearSelection()})}),Ve.imReady()}_textMenu(e){const t=()=>{var e="";return void 0!==window.getSelection?e=window.getSelection().toString():void 0!==this.shadowRoot.selection&&"Text"==this.shadowRoot.selection.type&&(e=this.shadowRoot.selection.createRange().text),e};(()=>{let s=t();if(s&&"string"==typeof s){let t={selectedText:s,eventObject:{pageX:e.pageX,pageY:e.pageY,clientX:e.clientX,clientY:e.clientY},isFrame:!0};Ve.request("openCopyTextMenu",t)}})()}clearSelection(){window.getSelection().removeAllRanges(),window.parent.getSelection().removeAllRanges()}})}));
